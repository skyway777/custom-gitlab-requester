import r from"ky-universal";import e from"form-data";import{decamelizeKeys as t}from"humps";import{stringify as n}from"query-string";import o from"https";import a from"fs";var i=function(){return(i=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);return r}).apply(this,arguments)};function u(r,e,t,n){return new(t||(t=Promise))(function(o,a){function i(r){try{c(n.next(r))}catch(r){a(r)}}function u(r){try{c(n.throw(r))}catch(r){a(r)}}function c(r){r.done?o(r.value):new t(function(e){e(r.value)}).then(i,u)}c((n=n.apply(r,e||[])).next())})}function c(r,e){var t,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(r,i)}catch(r){a=[6,r],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function s(r,e){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var n,o,a=t.call(r),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(r){o={error:r}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i}function f(r,e,t){return/^([A-Z0-9])+_*/.test(r)?r:e(r,t)}var l={};function p(r){var e={};return function(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(s(arguments[e]));return r}(r.headers.entries()).forEach(function(r){var t=s(r,2),n=t[0],o=t[1];e[n]=o}),e}function h(r){if(r)try{return a.readFileSync(r)}catch(e){throw"Error while reading file: "+r+". Error "+e}}function y(r,a){var i=a.body,u=a.query,c=a.sudo,s=a.method,l=new Headers(r.headers),p=i,y=function(){var r=process.env,e=r.GITLAB_SSL_KEY,t=r.GITLAB_SSL_CERT;if(e||t){console.log("GITLAB_SSL_KEY",e,"GITLAB_SSL_CERT",t);var n=h(e),a=h(t);return new o.Agent({key:n,cert:a})}}();return c&&l.append("sudo",""+c),"object"!=typeof i||i instanceof e||(p=JSON.stringify(t(i,f)),l.append("content-type","application/json")),{timeout:r.requestTimeout,headers:l,method:"stream"===s?"get":s,onProgress:"stream"===s?function(){}:void 0,searchParams:n(t(u||{}),{arrayFormat:"bracket"}),prefixUrl:r.url,body:p,agent:y}}function d(r){return u(this,void 0,void 0,function(){var e,t;return c(this,function(n){switch(n.label){case 0:return e=r.headers.get("content-type")||"",[4,r.text()];case 1:if(t=n.sent(),e.includes("json"))try{return[2,JSON.parse(t||"{}")]}catch(r){return[2,{}]}return[2,t]}})})}["get","post","put","delete","stream"].forEach(function(e){l[e]=function(t,n,o){return u(this,void 0,void 0,function(){var a,u,s,f,l,h;return c(this,function(c){switch(c.label){case 0:a=y(t,i({},o,{method:e})),c.label=1;case 1:return c.trys.push([1,3,,6]),[4,r(n,a)];case 2:return u=c.sent(),[3,6];case 3:return(s=c.sent()).response?[4,s.response.json()]:[3,5];case 4:f=c.sent(),s.description=f.error||f.message,c.label=5;case 5:throw s;case 6:return l=u.status,h=p(u),[4,d(u)];case 7:return[2,{body:c.sent(),headers:h,status:l}]}})})}});export{l as KyRequester,f as skipAllCaps};
